<!DOCTYPE html>
<html>
<head>
    <title>TON Wallet Auth</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
        }
        button {
            padding: 10px 20px;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="authSection" class="hidden">
        <p>Connected wallet: <span id="walletAddress"></span></p>
        <button onclick="disconnectWallet()">Disconnect</button>
    </div>

    <button id="connectButton" class="hidden" onclick="connectWallet()">Connect Wallet</button>

    <script>
        // Инициализация TON Connector
        const connector = new TonConnectSDK.TonConnect({
            manifestUrl: 'https://fatm1nd.github.io/titon_tma/tonconnect-manifest.json'
        });

        // Инициализация Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // Проверка существующего подключения при загрузке
        async function init() {
            const connected = await connector.restoreConnection();
            updateUI(connected);
        }

        // Обновление интерфейса в зависимости от статуса подключения
        function updateUI(isConnected) {
            document.getElementById('connectButton').classList.toggle('hidden', isConnected);
            document.getElementById('authSection').classList.toggle('hidden', !isConnected);
            
            if (isConnected) {
                const account = connector.account;
                document.getElementById('walletAddress').textContent = 
                    `${account.address.slice(0, 4)}...${account.address.slice(-4)}`;
            }
        }

        // Подключение кошелька
        async function connectWallet() {
            try {
                const walletsList = await connector.getWallets();
                const link = connector.connect(walletsList);
                tg.openLink(link);
                
                connector.onStatusChange(wallet => {
                    if (wallet) {
                        updateUI(true);
                    }
                });
            } catch (error) {
                console.error('Connection error:', error);
            }
        }

        // Отключение кошелька
        async function disconnectWallet() {
            await connector.disconnect();
            updateUI(false);
        }

        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>